<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Context API - NEAR Protocol Specification</title>
        

        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="Specification of the NEAR Protocol">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="shortcut icon" href="../../../favicon.png">
        <link rel="stylesheet" href="../../../css/variables.css">
        <link rel="stylesheet" href="../../../css/general.css">
        <link rel="stylesheet" href="../../../css/chrome.css">
        <link rel="stylesheet" href="../../../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../../../FontAwesome/css/font-awesome.css">
        <link href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800" rel="stylesheet" type="text/css">
        <link href="https://fonts.googleapis.com/css?family=Source+Code+Pro:500" rel="stylesheet" type="text/css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../../../highlight.css">
        <link rel="stylesheet" href="../../../tomorrow-night.css">
        <link rel="stylesheet" href="../../../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        

        
        <!-- MathJax -->
        <script async type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
        
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "../../../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "light" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="../../../README.html"><strong aria-hidden="true">1.</strong> Introduction</a></li><li class="chapter-item expanded "><a href="../../../Terminology.html"><strong aria-hidden="true">2.</strong> Terminology</a></li><li class="chapter-item expanded "><a href="../../../DataStructures/README.html"><strong aria-hidden="true">3.</strong> Data Structures</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../../DataStructures/Account.html"><strong aria-hidden="true">3.1.</strong> Account</a></li><li class="chapter-item expanded "><a href="../../../DataStructures/AccessKey.html"><strong aria-hidden="true">3.2.</strong> Access Key</a></li><li class="chapter-item expanded "><a href="../../../DataStructures/Transaction.html"><strong aria-hidden="true">3.3.</strong> Transaction</a></li></ol></li><li class="chapter-item expanded "><a href="../../../Architecture.html"><strong aria-hidden="true">4.</strong> Architecture</a></li><li class="chapter-item expanded "><a href="../../../ChainSpec/README.html"><strong aria-hidden="true">5.</strong> Chain specification</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../../ChainSpec/Consensus.html"><strong aria-hidden="true">5.1.</strong> Consensus</a></li><li class="chapter-item expanded "><a href="../../../ChainSpec/Upgradability.html"><strong aria-hidden="true">5.2.</strong> Upgradability</a></li><li class="chapter-item expanded "><a href="../../../ChainSpec/Transactions.html"><strong aria-hidden="true">5.3.</strong> Transactions</a></li><li class="chapter-item expanded "><a href="../../../ChainSpec/LightClient.html"><strong aria-hidden="true">5.4.</strong> Light Client</a></li></ol></li><li class="chapter-item expanded "><a href="../../../RuntimeSpec/README.html"><strong aria-hidden="true">6.</strong> Runtime specification</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../../RuntimeSpec/FunctionCall.html"><strong aria-hidden="true">6.1.</strong> FunctionCall</a></li><li class="chapter-item expanded "><a href="../../../RuntimeSpec/Transactions.html"><strong aria-hidden="true">6.2.</strong> Transactions</a></li><li class="chapter-item expanded "><a href="../../../RuntimeSpec/Actions.html"><strong aria-hidden="true">6.3.</strong> Actions</a></li><li class="chapter-item expanded "><a href="../../../RuntimeSpec/Receipts.html"><strong aria-hidden="true">6.4.</strong> Receipts</a></li><li class="chapter-item expanded "><a href="../../../RuntimeSpec/Scenarios/Scenarios.html"><strong aria-hidden="true">6.5.</strong> Scenarios</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../../RuntimeSpec/Scenarios/FinancialTransaction.html"><strong aria-hidden="true">6.5.1.</strong> Financial Transaction</a></li><li class="chapter-item expanded "><a href="../../../RuntimeSpec/Scenarios/CrossContractCall.html"><strong aria-hidden="true">6.5.2.</strong> Cross-Contract Call</a></li></ol></li><li class="chapter-item expanded "><a href="../../../RuntimeSpec/Components/Components.html"><strong aria-hidden="true">6.6.</strong> Components</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../../RuntimeSpec/Components/RuntimeCrate.html"><strong aria-hidden="true">6.6.1.</strong> Runtime crate</a></li><li class="chapter-item expanded "><a href="../../../RuntimeSpec/Components/BindingsSpec/BindingsSpec.html"><strong aria-hidden="true">6.6.2.</strong> Bindings Specification</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../../RuntimeSpec/Components/BindingsSpec/RegistersAPI.html"><strong aria-hidden="true">6.6.2.1.</strong> Registers API</a></li><li class="chapter-item expanded "><a href="../../../RuntimeSpec/Components/BindingsSpec/TrieAPI.html"><strong aria-hidden="true">6.6.2.2.</strong> Trie API</a></li><li class="chapter-item expanded "><a href="../../../RuntimeSpec/Components/BindingsSpec/PromisesAPI.html"><strong aria-hidden="true">6.6.2.3.</strong> Promises API</a></li><li class="chapter-item expanded "><a href="../../../RuntimeSpec/Components/BindingsSpec/ContextAPI.html" class="active"><strong aria-hidden="true">6.6.2.4.</strong> Context API</a></li><li class="chapter-item expanded "><a href="../../../RuntimeSpec/Components/BindingsSpec/EconomicsAPI.html"><strong aria-hidden="true">6.6.2.5.</strong> Economics API</a></li><li class="chapter-item expanded "><a href="../../../RuntimeSpec/Components/BindingsSpec/MathAPI.html"><strong aria-hidden="true">6.6.2.6.</strong> Math API</a></li><li class="chapter-item expanded "><a href="../../../RuntimeSpec/Components/BindingsSpec/MiscellaneousAPI.html"><strong aria-hidden="true">6.6.2.7.</strong> Miscellaneous API</a></li></ol></li></ol></li></ol></li><li class="chapter-item expanded "><a href="../../../GenesisConfig/GenesisConfig.html"><strong aria-hidden="true">7.</strong> GenesisConfig</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../../GenesisConfig/RuntimeConfig.html"><strong aria-hidden="true">7.1.</strong> RuntimeConfig</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../../GenesisConfig/RuntimeFeeConfig.html"><strong aria-hidden="true">7.1.1.</strong> RuntimeFeeConfig</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../../GenesisConfig/RuntimeFeeConfig/AccessKeyCreationConfig.html"><strong aria-hidden="true">7.1.1.1.</strong> AccessKeyCreationConfig</a></li><li class="chapter-item expanded "><a href="../../../GenesisConfig/RuntimeFeeConfig/ActionCreationConfig.html"><strong aria-hidden="true">7.1.1.2.</strong> ActionCreationConfig</a></li><li class="chapter-item expanded "><a href="../../../GenesisConfig/RuntimeFeeConfig/DataReceiptCreationConfig.html"><strong aria-hidden="true">7.1.1.3.</strong> DataReceiptCreationConfig</a></li><li class="chapter-item expanded "><a href="../../../GenesisConfig/RuntimeFeeConfig/StorageUsageConfig.html"><strong aria-hidden="true">7.1.1.4.</strong> StorageUsageConfig</a></li><li class="chapter-item expanded "><a href="../../../GenesisConfig/RuntimeFeeConfig/Fee.html"><strong aria-hidden="true">7.1.1.5.</strong> Fee</a></li><li class="chapter-item expanded "><a href="../../../GenesisConfig/RuntimeFeeConfig/Fraction.html"><strong aria-hidden="true">7.1.1.6.</strong> Fraction</a></li></ol></li><li class="chapter-item expanded "><a href="../../../GenesisConfig/VMConfig.html"><strong aria-hidden="true">7.1.2.</strong> VMConfig</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../../GenesisConfig/ExtCostsConfig.html"><strong aria-hidden="true">7.1.2.1.</strong> ExtCostsConfig</a></li></ol></li><li class="chapter-item expanded "><a href="../../../GenesisConfig/StateRecord.html"><strong aria-hidden="true">7.1.3.</strong> StateRecord</a></li></ol></li></ol></li><li class="chapter-item expanded "><a href="../../../Economics/README.html"><strong aria-hidden="true">8.</strong> Economics</a></li><li class="chapter-item expanded "><a href="../../../Standards/README.html"><strong aria-hidden="true">9.</strong> Standards</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../../Standards/Tokens/FungibleToken.html"><strong aria-hidden="true">9.1.</strong> Fungible Token</a></li></ol></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                        
                    </div>

                    <h1 class="menu-title">NEAR Protocol Specification</h1>

                    <div class="right-buttons">
                        <a href="../../../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        
                    </div>
                </div>

                
                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" name="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1><a class="header" href="#context-api" id="context-api">Context API</a></h1>
<p>Context API mostly provides read-only functions that access current information about the blockchain, the accounts
(that originally initiated the chain of cross-contract calls, the immediate contract that called the current one, the account of the current contract),
other important information like storage usage.</p>
<p>Many of the below functions are currently implemented through <code>data_read</code> which allows to read generic context data.
However, there is no reason to have <code>data_read</code> instead of the specific functions:</p>
<ul>
<li><code>data_read</code> does not solve forward compatibility. If later we want to add another context function, e.g. <code>executed_operations</code>
we can just declare it as a new function, instead of encoding it as <code>DATA_TYPE_EXECUTED_OPERATIONS = 42</code> which is passed
as the first argument to <code>data_read</code>;</li>
<li><code>data_read</code> does not help with renaming. If later we decide to rename <code>signer_account_id</code> to <code>originator_id</code> then one could
argue that contracts that rely on <code>data_read</code> would not break, while contracts relying on <code>signer_account_id()</code> would. However
the name change often means the change of the semantics, which means the contracts using this function are no longer safe to
execute anyway.</li>
</ul>
<p>However there is one reason to not have <code>data_read</code> -- it makes <code>API</code> more human-like which is a general direction Wasm APIs, like WASI are moving towards to.</p>
<hr />
<pre><pre class="playpen"><code class="language-rust">
<span class="boring">#![allow(unused_variables)]
</span><span class="boring">fn main() {
</span>current_account_id(register_id: u64)
<span class="boring">}
</span></code></pre></pre>
<p>Saves the account id of the current contract that we execute into the register.</p>
<h6><a class="header" href="#panics" id="panics">Panics</a></h6>
<ul>
<li>If the registers exceed the memory limit panics with <code>MemoryAccessViolation</code>;</li>
</ul>
<hr />
<pre><pre class="playpen"><code class="language-rust">
<span class="boring">#![allow(unused_variables)]
</span><span class="boring">fn main() {
</span>signer_account_id(register_id: u64)
<span class="boring">}
</span></code></pre></pre>
<p>All contract calls are a result of some transaction that was signed by some account using
some access key and submitted into a memory pool (either through the wallet using RPC or by a node itself). This function returns the id of that account.</p>
<h6><a class="header" href="#normal-operation" id="normal-operation">Normal operation</a></h6>
<ul>
<li>Saves the bytes of the signer account id into the register.</li>
</ul>
<h6><a class="header" href="#panics-1" id="panics-1">Panics</a></h6>
<ul>
<li>If the registers exceed the memory limit panics with <code>MemoryAccessViolation</code>;</li>
<li>If called in a view function panics with <code>ProhibitedInView</code>.</li>
</ul>
<h6><a class="header" href="#current-bugs" id="current-bugs">Current bugs</a></h6>
<ul>
<li>Currently we conflate <code>originator_id</code> and <code>sender_id</code> in our code base.</li>
</ul>
<hr />
<pre><pre class="playpen"><code class="language-rust">
<span class="boring">#![allow(unused_variables)]
</span><span class="boring">fn main() {
</span>signer_account_pk(register_id: u64)
<span class="boring">}
</span></code></pre></pre>
<p>Saves the public key fo the access key that was used by the signer into the register.
In rare situations smart contract might want to know the exact access key that was used to send the original transaction,
e.g. to increase the allowance or manipulate with the public key.</p>
<h6><a class="header" href="#panics-2" id="panics-2">Panics</a></h6>
<ul>
<li>If the registers exceed the memory limit panics with <code>MemoryAccessViolation</code>;</li>
<li>If called in a view function panics with <code>ProhibitedInView</code>.</li>
</ul>
<h6><a class="header" href="#current-bugs-1" id="current-bugs-1">Current bugs</a></h6>
<ul>
<li>Not implemented.</li>
</ul>
<hr />
<pre><pre class="playpen"><code class="language-rust">
<span class="boring">#![allow(unused_variables)]
</span><span class="boring">fn main() {
</span>predecessor_account_id(register_id: u64)
<span class="boring">}
</span></code></pre></pre>
<p>All contract calls are a result of a receipt, this receipt might be created by a transaction
that does function invocation on the contract or another contract as a result of cross-contract call.</p>
<h6><a class="header" href="#normal-operation-1" id="normal-operation-1">Normal operation</a></h6>
<ul>
<li>Saves the bytes of the predecessor account id into the register.</li>
</ul>
<h6><a class="header" href="#panics-3" id="panics-3">Panics</a></h6>
<ul>
<li>If the registers exceed the memory limit panics with <code>MemoryAccessViolation</code>;</li>
<li>If called in a view function panics with <code>ProhibitedInView</code>.</li>
</ul>
<h6><a class="header" href="#current-bugs-2" id="current-bugs-2">Current bugs</a></h6>
<ul>
<li>Not implemented.</li>
</ul>
<hr />
<pre><pre class="playpen"><code class="language-rust">
<span class="boring">#![allow(unused_variables)]
</span><span class="boring">fn main() {
</span>input(register_id: u64)
<span class="boring">}
</span></code></pre></pre>
<p>Reads input to the contract call into the register. Input is expected to be in JSON-format.</p>
<h6><a class="header" href="#normal-operation-2" id="normal-operation-2">Normal operation</a></h6>
<ul>
<li>If input is provided saves the bytes (potentially zero) of input into register.</li>
<li>If input is not provided does not modify the register.</li>
</ul>
<h6><a class="header" href="#returns" id="returns">Returns</a></h6>
<ul>
<li>If input was not provided returns <code>0</code>;</li>
<li>If input was provided returns <code>1</code>; If input is zero bytes returns <code>1</code>, too.</li>
</ul>
<h6><a class="header" href="#panics-4" id="panics-4">Panics</a></h6>
<ul>
<li>If the registers exceed the memory limit panics with <code>MemoryAccessViolation</code>;</li>
</ul>
<h6><a class="header" href="#current-bugs-3" id="current-bugs-3">Current bugs</a></h6>
<ul>
<li>Implemented as part of <code>data_read</code>. However there is no reason to have one unified function, like <code>data_read</code> that can
be used to read all</li>
</ul>
<hr />
<pre><pre class="playpen"><code class="language-rust">
<span class="boring">#![allow(unused_variables)]
</span><span class="boring">fn main() {
</span>block_index() -&gt; u64
<span class="boring">}
</span></code></pre></pre>
<p>Returns the current block height from genesis.</p>
<hr />
<pre><pre class="playpen"><code class="language-rust">
<span class="boring">#![allow(unused_variables)]
</span><span class="boring">fn main() {
</span>block_timestamp() -&gt; u64
<span class="boring">}
</span></code></pre></pre>
<p>Returns the current block timestamp (number of non-leap-nanoseconds since January 1, 1970 0:00:00 UTC).</p>
<hr />
<pre><pre class="playpen"><code class="language-rust">
<span class="boring">#![allow(unused_variables)]
</span><span class="boring">fn main() {
</span>epoch_height() -&gt; u64
<span class="boring">}
</span></code></pre></pre>
<p>Returns the current epoch height from genesis.</p>
<hr />
<pre><pre class="playpen"><code class="language-rust">
<span class="boring">#![allow(unused_variables)]
</span><span class="boring">fn main() {
</span>storage_usage() -&gt; u64
<span class="boring">}
</span></code></pre></pre>
<p>Returns the number of bytes used by the contract if it was saved to the trie as of the
invocation. This includes:</p>
<ul>
<li>The data written with <code>storage_*</code> functions during current and previous execution;</li>
<li>The bytes needed to store the account protobuf and the access keys of the given account.</li>
</ul>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                        
                            <a rel="prev" href="../../../RuntimeSpec/Components/BindingsSpec/PromisesAPI.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>
                        

                        
                            <a rel="next" href="../../../RuntimeSpec/Components/BindingsSpec/EconomicsAPI.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>
                        

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                
                    <a rel="prev" href="../../../RuntimeSpec/Components/BindingsSpec/PromisesAPI.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>
                

                
                    <a rel="next" href="../../../RuntimeSpec/Components/BindingsSpec/EconomicsAPI.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
                
            </nav>

        </div>

        

        

        
        
        
        <script type="text/javascript">
            window.playpen_copyable = true;
        </script>
        

        

        
        <script src="../../../elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../../../mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../../../searcher.js" type="text/javascript" charset="utf-8"></script>
        

        <script src="../../../clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../../../highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="../../../book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        

        

    </body>
</html>
