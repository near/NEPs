---
NEP: 0461
Title: Prefix Tag for Non-Transactional Messages
Author: Gallardo Guillermo <guillermo@near.org>, Firat Sertgoz <firat@near.org>
DiscussionsTo: https://github.com/nearprotocol/neps/pull/XXX
Status: Draft
Type: Standards Track
Category: Tools
Version: 1.0.0
Created: 14-Feb-2023
Updated: 14-Feb-2023
---

## Summary
A proposal to include a standardized prefix in all signed messages that are not transactions. 

Particularly, we propose to prepend the <$2^{31}$ + NEP-number> prefix to all non-transactional messages.

## Motivation
As the ecosystem grows, more wallet standards will appear, enabling users to sign messages that are not transactions (e.g. [NEP413](https://github.com/near/NEPs/pull/413/), and [NEP366](https://github.com/near/NEPs/blob/master/neps/nep-0366.md)). If such messages collide with transactions, a malicious app could ask users to sign them, only to later relay them as valid transactions to the network.

## Rationale and alternatives

In NEAR, users sign transactions that are later relayed to the network. At the moment of being relayed, the transactions are simple streams of bytes that a node then parses into a [valid transaction](https://nomicon.io/RuntimeSpec/Transactions).

As the protocol expands, more non-transactional messages will be added for users to sign. We want users to be able to use the protocol safely, making sure that all those signed message cannot be interpreted as a valid transaction.

Including a `u32` fixed prefix with value <$2^{31}$+NEP-number> will enable to easily distinguish non-transactional messages from transactions, while also ensuring that they never overlap. This is because the first parameter of a [valid transactions](https://nomicon.io/RuntimeSpec/Transactions) is an `AccountId`, which is encoded as `string length <u32>` + `string chars <u32[]>`. Adding a prefix in the range of $2^31 - 2^32$ will automatically make the non-transactional message to deserialize into an invalid transaction, since no `AccountId` has more than 64 chars.

## Specification

All non-transactional messages should have a structure which first parameter is a `prefix: u32`.

For example, if we want to simply make the user sign a message, and the proposal has the number `NEP400`, then the structure of the message to be sign must be:

```ts
MessageToSign{
    prefix: u32 // fixed to 2**31 + 400 == 2147484048
    message: string;
}
```

## Security Implications

All non-transactional messages will be ensured to not be parsable into valid transactions.

## Drawbacks

We will need to update [NEP366](https://github.com/near/NEPs/blob/master/neps/nep-0366.md) to follow this standard, and make sure all future NEPs follow it, which might be hard to track.

If at any point there is an update on how transactions are encoded, this NEP could stop being valid.   


## Future possibilities

A future possibility is to update the transactions structure, such that they also include a prefix, in this case lower than  $2^31$.